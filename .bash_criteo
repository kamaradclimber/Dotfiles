# /* vim: set filetype=sh : */


__whereami() {
  if grep 'search criteois.lan' /etc/resolv.conf > /dev/null ; then
    echo "criteo"
  elif grep '192.168.0.1' /etc/resolv.conf > /dev/null; then
    echo "mothership" #quick test but 100% sure
  elif curl -s icanhazip.com | grep -q 78.194.186.226; then
    echo "mothership"
  else
    echo "elsewhere"
  fi
}

__mothership() {
  local home=familleseux.net
  case $(__whereami) in
    criteo )
      echo "ssh -p 443 grego@$home";;
    mothership )
      echo "ssh grego@192.168.0.189";;
    *)
      echo "ssh grego@$home";;
  esac
}

__rss() {
  echo "$(__mothership) -t screen -x mutt"
}
alias rss='eval "$(__rss)"'

__homepage() {
  case $(__whereami) in
    criteo )
      export HOMEPAGE='https://jira.criteois.com/secure/RapidBoard.jspa?rapidView=362'
  esac
}

__homepage "nen"

__irc() {
  echo "$(__mothership) -t screen -x irc"
}

alias irc='eval "$(__irc)"'

function knife_until {
  if [ $# -ne 1 ]; then
    echo "USAGE: $0 <NODE_NAME>" >&2
    exit 1
  fi
  NODE_NAME=$1
  START_TIME=$(date +%s)
  CURRENT_TIME=${START_TIME}
  KNIFE_OPTS="-i -R 1"
  TIMEOUT_TIME=$(date -d "${TIMEOUT} seconds" +%s)
  while ! bundle exec knife search node "name:${NODE_NAME} AND ohai_time:[${START_TIME} TO ${CURRENT_TIME}]" ${KNIFE_OPTS} | grep -q ${NODE_NAME};
  do
    echo -n .
    sleep 30
    CURRENT_TIME=$(date +%s)
  done
}
